<div class="container">
  <div class="row col-7 mt-5 mb-4 mx-auto">
    <% if @reservation.errors.any? %>
      <%= @reservation.errors.full_messages %>
    <% end %>
    <h1 class="text-center">新規予約画面</h1>
    
    <div class="col-7 mx-auto mt-3">
      <%= form_with model: @reservation, url: admins_reservations_path, local: true, class: 'form' do |form| %>
      
        <div class="day form-group">
          <%= form.label :day, '日付', class: "form-label" %>
          <%= form.text_field :day, class: 'form-control', value: @day, readonly: true %>
        </div>
        
        <div class="row">
          <div class="time form-group my-3 col-6">
            <%= form.label :time, '開始時間', class: "form-label" %>
            <%= form.text_field :time, class: 'form-control', value: @time, readonly: true %>
          </div>
        
          <div class="end_time form-group my-3 col-6">
            <%= form.label :end_time, '終了時間', class: "form-label" %>
            <div class="d-flex">
              <%= form.time_select :end_time, { start_hour: 9, end_hour: 23, minute_step: 30, include_seconds: false }, { class: 'form-control mr-2', id: 'end_time_select' } %>
            </div>
          </div>
        </div>
      
        <table class="mt-3">
          <tbody>
            <tr>
              <% if params[:user_id].present? %>
                <% @reservation.user_id = params[:user_id] %>
                <%= @user.name %>
                <%= form.hidden_field :user_id, value: @reservation.user_id %>
              <% end %>
              <% if @user_id.present? %>
                <%= link_to "ユーザーを変更", admins_users_path(source: 'new_admins_users', day: @day, time: @time) %>
                |
                <%= link_to "削除", new_admins_reservation_path(day: @day, time: @time), id: "delete-user-link" %>
              <% else %>
                <%= link_to "ユーザーを追加", admins_users_path(source: 'new_admins_users', day: @day, time: @time), id: 'add-user-link' %>
              <% end %>
            </tr>
          </tbody>
        </table>
      
        <%= check_box_tag "reservation[user_id]", "new", false, id: "new-user-checkbox" %>
        <%= label_tag "new-user-checkbox", "任意の名前を入力" %>

        <%= text_field_tag "reservation[new_user_name]", nil, id: "new-user-name", placeholder: "ユーザー名を入力してください", class: "form-control d-none" %>
        
        
        <div class="comment form-group mt-2">
          <%= form.label :comment, '備考欄', class: "form-label" %>
          <%= form.text_area :comment, class: 'form-control' %>
        </div>
        
        <%#= form.hidden_field :start_time, value: @start_time %>
        <%= form.hidden_field :admin_id, value: current_admin.id %>
      
        <div class="submit">
          <%= form.submit value: '予約する', class: 'btn btn-primary mx-auto d-block mt-3' %>
        </div>
        
      <% end %>
    </div>
  </div>
</div>


<script>
  document.addEventListener('turbolinks:load', function() {
    let deleteLink = document.getElementById('delete-user-link');
    let newUserNameField = document.getElementById('new-user-name');
    let newUserCheckbox = document.getElementById('new-user-checkbox');
    let addLink = document.getElementById('add-user-link');

    newUserCheckbox.addEventListener('change', function() {
      if (newUserCheckbox.checked) {
        if (deleteLink) {
          deleteLink.click();
        }
        newUserNameField.classList.remove('d-none');
        addLink.style.display = 'none';
      } else {
        newUserNameField.classList.add('d-none');
        addLink.style.display = 'block';
      }
    });
  });
</script>
