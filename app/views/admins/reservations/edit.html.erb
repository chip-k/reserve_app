<div class="container days">
  <div class="row col-10 mt-5 mb-4 mx-auto">
    <div class="text-center title">
      <h2>予約編集画面</h2>
      <%= form_with model: @reservation, url: admins_reservation_path(@reservation), method: :patch, local: true, id: "edit-form" do |f| %>
        <%= f.label :day, "日付", class: "form-label" %>
        <%= f.date_field :day, value: @reservation.day.to_date, name: "reservation[day]", id: "reservation-day" %>
        
        <%= f.label :time, "時間", class: "form-label" %>
        
        <%= select_tag "reservation[time]", options_for_select((9..19).flat_map { |hour| [["#{hour}:00", "#{hour}:00"], ["#{hour}:30", "#{hour}:30"]] }, selected: @reservation&.time), include_blank: false, prompt: '選択してください' %>
        
        <br>
        <%= f.label :user_id, "ユーザー名", class: "form-label" %>
        
        <% user_options = User.where(id: @reservation.user_id).pluck(:name, :id) %>
        <% user_options << ["西圓寺", "saienji"] %>
        
        <%= select_tag "reservation[user_id]", options_for_select(user_options.push(["任意の名前を入力", "new"])), include_blank: true, id: "user-select", onchange: "toggleNewUserName(this)" %>
        <%= text_field_tag "reservation[new_user_name]", nil, id: "new-user-name", placeholder: "ユーザー名を入力してください", class: "form-control d-none" %>

        <%= f.submit "更新", class: "btn btn-primary" %>
        
      <% end %>
    </div>
  </div>
</div>
        
<script>
  function toggleNewUserName(selectElement) {
    let newUserName = document.getElementById('new-user-name');
    if (selectElement.value === 'new') {
      newUserName.classList.remove('d-none');
    } else {
      newUserName.classList.add('d-none');
    }
  }
</script>